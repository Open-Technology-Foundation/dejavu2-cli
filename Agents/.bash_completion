#!/bin/bash
# Bash completion for dv2-agents and dv2-agents-aliases

_dv2_agents() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  # Main commands
  local commands="list categories insert remove edit"
  
  # Get the first command argument (skip the script name)
  local cmd=""
  if [ ${#COMP_WORDS[@]} -gt 1 ]; then
    cmd="${COMP_WORDS[1]}"
  fi

  case "${cmd}" in
    list)
      case "${prev}" in
        -c|--category)
          # Complete with available categories
          local categories=$(dv2-agents categories 2>/dev/null || echo "General Specialist Edit-Summarize")
          COMPREPLY=($(compgen -W "${categories}" -- "${cur}"))
          return 0
          ;;
        list)
          # Complete with agent names or options
          local agents=$(dv2-agents list 2>/dev/null | cut -d' ' -f1)
          local options="-l --long -c --category"
          COMPREPLY=($(compgen -W "${agents} ${options}" -- "${cur}"))
          return 0
          ;;
        *)
          # Complete with agent names or options
          local agents=$(dv2-agents list 2>/dev/null | cut -d' ' -f1)
          local options="-l --long -c --category"
          COMPREPLY=($(compgen -W "${agents} ${options}" -- "${cur}"))
          return 0
          ;;
      esac
      ;;
    insert)
      case "${prev}" in
        --model)
          # Complete with available models from parent directory
          local models=""
          if [ -f "../Models.json" ]; then
            models=$(python3 -c "import json; print(' '.join(json.load(open('../Models.json')).keys()))" 2>/dev/null || echo "")
          fi
          if [ -z "$models" ]; then
            models="claude-3-5-sonnet-latest claude-sonnet-4-0 gpt-4o chatgpt-4o-latest"
          fi
          COMPREPLY=($(compgen -W "${models}" -- "${cur}"))
          return 0
          ;;
        --category)
          # Complete with available categories
          local categories=$(dv2-agents categories 2>/dev/null || echo "General Specialist Edit-Summarize")
          COMPREPLY=($(compgen -W "${categories}" -- "${cur}"))
          return 0
          ;;
        --temperature)
          # Complete with common temperature values
          COMPREPLY=($(compgen -W "0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0" -- "${cur}"))
          return 0
          ;;
        --max_tokens)
          # Complete with common token limits
          COMPREPLY=($(compgen -W "1000 2000 4000 8000 16000 32000" -- "${cur}"))
          return 0
          ;;
        --monospace)
          # Complete with boolean values
          COMPREPLY=($(compgen -W "true false" -- "${cur}"))
          return 0
          ;;
        insert)
          # Don't complete agent name (user needs to provide it)
          return 0
          ;;
        *)
          # Complete with insert options
          local insert_opts="--category --systemprompt --model --max_tokens --temperature --knowledgebase --monospace"
          COMPREPLY=($(compgen -W "${insert_opts}" -- "${cur}"))
          return 0
          ;;
      esac
      ;;
    remove|edit)
      case "${prev}" in
        remove|edit)
          # Complete with existing agent names
          local agents=$(dv2-agents list 2>/dev/null | cut -d' ' -f1)
          COMPREPLY=($(compgen -W "${agents}" -- "${cur}"))
          return 0
          ;;
      esac
      ;;
    categories)
      # No completion needed for categories command
      return 0
      ;;
    *)
      # Complete with main commands
      COMPREPLY=($(compgen -W "${commands}" -- "${cur}"))
      return 0
      ;;
  esac
}

_dv2_agents_aliases() {
  local cur prev opts
  COMPREPLY=()
  cur="${COMP_WORDS[COMP_CWORD]}"
  prev="${COMP_WORDS[COMP_CWORD-1]}"

  # Available options for dv2-agents-aliases
  local options="-a --update-bash-aliases -l --list list -h --help"

  case "${prev}" in
    dv2-agents-aliases)
      COMPREPLY=($(compgen -W "${options}" -- "${cur}"))
      return 0
      ;;
    *)
      COMPREPLY=($(compgen -W "${options}" -- "${cur}"))
      return 0
      ;;
  esac
}

# Register completion functions
complete -F _dv2_agents dv2-agents
complete -F _dv2_agents_aliases dv2-agents-aliases

#fin